!function(){function t(){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},e=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(e,function(e){return t[e]||e}):this}}function e(t,i,n){return("string"==typeof i?i:i.toString()).replace(t.define||r,function(e,i,o,a){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in n||(":"===o?(t.defineParams&&a.replace(t.defineParams,function(t,e,o){n[i]={arg:e,text:o}}),i in n||(n[i]=a)):new Function("def","def['"+i+"']="+a)(n)),""}).replace(t.use||r,function(i,o){t.useParams&&(o=o.replace(t.useParams,function(t,e,i,o){if(n[i]&&n[i].arg&&o){var a=(i+":"+o).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[a]=n[i].text.replace(new RegExp("(^|[^\\w$])"+n[i].arg+"([^\\w$])","g"),"$1"+o+"$2"),e+"def.__exp['"+a+"']"}}));var a=new Function("def","return "+o)(n);return a?e(t,a,n):a})}function i(t){return t.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var n,o={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define("source/js/themes/pandora/_plugins/doT",[],function(){return o}):(n=function(){return this||(0,eval)("this")}(),n.doT=o),String.prototype.encodeHTML=t();var a={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},r=/$^/;o.template=function(n,s,c){s=s||o.templateSettings;var l,u,d=s.append?a.append:a.split,h=0,m=s.use||s.define?e(s,n,c||{}):n;m=("var out='"+(s.strip?m.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):m).replace(/'|\\/g,"\\$&").replace(s.interpolate||r,function(t,e){return d.start+i(e)+d.end}).replace(s.encode||r,function(t,e){return l=!0,d.start+i(e)+d.endencode}).replace(s.conditional||r,function(t,e,n){return e?n?"';}else if("+i(n)+"){out+='":"';}else{out+='":n?"';if("+i(n)+"){out+='":"';}out+='"}).replace(s.iterate||r,function(t,e,n,o){return e?(h+=1,u=o||"i"+h,e=i(e),"';var arr"+h+"="+e+";if(arr"+h+"){var "+n+","+u+"=-1,l"+h+"=arr"+h+".length-1;while("+u+"<l"+h+"){"+n+"=arr"+h+"["+u+"+=1];out+='"):"';} } out+='"}).replace(s.evaluate||r,function(t,e){return"';"+i(e)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),l&&s.selfcontained&&(m="String.prototype.encodeHTML=("+t.toString()+"());"+m);try{return new Function(s.varname,m)}catch(p){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+m),p}},o.compile=function(t,e){return o.template(t,null,e)}}(),+function(t){function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one(t.support.transition.end,function(){i=!0});var o=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(o,e),this},t(function(){t.support.transition=e()})}(jQuery),!function(t){var e=function(e,i){this.options=i,this.$element=t(e).delegate('[data-dismiss="modal"]',"click.dismiss.modal",t.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};e.prototype={constructor:e,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var e=this,i=t.Event("show");this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var i=t.support.transition&&e.$element.hasClass("fade");e.$element.parent().length||e.$element.appendTo(document.body),e.$element.show(),i&&e.$element[0].offsetWidth,e.$element.addClass("in").attr("aria-hidden",!1),e.enforceFocus(),i?e.$element.one(t.support.transition.end,function(){e.$element.focus().trigger("shown")}):e.$element.focus().trigger("shown")}))},hide:function(e){e&&e.preventDefault();e=t.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),t.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var e=this;t(document).on("focusin.modal",function(t){e.$element[0]===t.target||e.$element.has(t.target).length||e.$element.focus()})},escape:function(){var t=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&t.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var e=this,i=setTimeout(function(){e.$element.off(t.support.transition.end),e.hideModal()},500);this.$element.one(t.support.transition.end,function(){clearTimeout(i),e.hideModal()})},hideModal:function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=t.support.transition&&i,o=t(document).height(),a="100%";if(this.$backdrop=t('<div class="modal-backdrop '+i+'" />').appendTo(document.body),this.$backdrop.css({width:a,height:o}).click("static"==this.options.backdrop?t.proxy(this.$element[0].focus,this.$element[0]):t.proxy(this.hide,this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;n?this.$backdrop.one(t.support.transition.end,e):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e):e()):e&&e()}};var i=t.fn.modal;t.fn.modal=function(i){return this.each(function(){var n=t(this),o=n.data("modal"),a=t.extend({},t.fn.modal.defaults,n.data(),"object"==typeof i&&i);o||n.data("modal",o=new e(this,a)),"string"==typeof i?o[i]():a.show&&o.show()})},t.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=i,this},t(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var i=t(this),n=i.attr("href"),o=t(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),a=o.data("modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},o.data(),i.data());e.preventDefault(),o.modal(a).one("hide",function(){i.focus()})})}(window.jQuery),window.MICONTST=$.extend(window.MICONTST,{CODE:{ADDCARTSUC:0,MAXITEMNUM:2003009,GODAMIAO:90001,GODAMIAONOTLOGIN:80003}}),Xiaomi=function(t){this.globalConfig=$.extend({},t)},function(){function t(t){this.context=t;var e=this;if(this.userId=Xiaomi.utils.cookie("userId"),this.userName="",!this.userId)return!1;var i=Xiaomi.utils.cookie("XM_"+this.userId+"_UN");this.userName=this.userId?i?i.replace(/[<>]/g,""):i:"",this.userName?this.signedIn():$.ajax({url:"https://account.xiaomi.com/pass/userInfoJsonP?callback=?",data:{userId:this.userId},dataType:"jsonp",success:function(t){t&&t.userId&&(e.userName=t.miliaoInfo&&t.miliaoInfo.nickName?t.miliaoInfo.nickName:t.userId,e.context.localCookie("XM_"+t.userId+"_UN",e.userName),e.signedIn())}})}var e;Xiaomi.prototype.logonUser=function(){return e=e||new t(this)},t.prototype.signedIn=function(){$("#J_userName").text(this.userName||this.userId),$("#J_signEntries").hide(),$("#J_signedUser").show()}}(),Xiaomi.prototype.proxyIframe=function(t,e){var i='<iframe src="'+("https"==this.globalConfig.protocol?this.globalConfig.httpsOrderSite:this.globalConfig.orderSite)+'/login/proxy" width="0" height="0" name="proxy" id="proxy" frameborder="0" scrolling="no"></iframe>';$(document.body).append(i),$("iframe[name=proxy]").load(function(){"function"==typeof t&&t.call(e),$(this).remove()})},Xiaomi.prototype.localCookie=function(t,e){var i={path:"/"+this.globalConfig.appLocal.name,domain:".mi.com"};Xiaomi.utils.cookie(t,e,i)},Xiaomi.utils={cookie:function(t,e,i){if(arguments.length>1&&"[object Object]"!==String(e)){if(i=jQuery.extend({},i),("undefined"==typeof e||null==e)&&(i.expires=-1),"number"==typeof i.expires){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}return e=String(e),document.cookie=[encodeURIComponent(t),"=",i.raw?e:encodeURIComponent(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}i=e||{};var a,r=i.raw?function(t){return t}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie))?r(a[1].replace(/\+/g,"%20")):null},jsonp:function(t){var e={error:function(){},success:function(e){var i=0;if("undefined"!=typeof e.errno)i=e.errno;else{if("undefined"==typeof e.code)return console.log("Error Format Interface"),!1;i=e.code}if(0===parseInt(i))t.successcallback&&t.successcallback(e);else if(20006===parseInt(i)){var n=GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl=";window.location.href=n+window.location.href}else t.errorcallback&&t.errorcallback(e)},timeout:5e3,dataType:"jsonp",jsonp:"jsonpcallback",cache:!1},i=$.extend({},e,t);$.ajax(i)},login:function(){var t=GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl=";window.location.href=t+window.location.href}},Xiaomi.formatNum=function(t,e){"number"!=typeof t&&(t=1*t),"id"!==e&&(t=t.toFixed(2)),t=parseFloat((t+"").replace(/[^\d\.-]/g,""))+"";var i,n,o=(t+"").split(".")[0].split(""),a=t.split(".")[1];for(i="id"===e?".":"in"===e?",":"",n=o.length;n>3;n-=3)o.splice(n-3,0,i);return a?o.join("")+"."+a:o.join("")},function(){function t(t){this.context=t;var e=this,i=!1;this.miniCartEntry=$("#J_miniCartEntry"),this.cartNum,this.itemListTemplate=doT.template($("#J_miniCartItemListTemplate").html()),this.updateCartNum(),this.removing=!1,this.miniCartEntry.on("click",".J_itemRemove",function(){var t=$(this).data("gid");return e.removeGoods(t),!1}).on("mouseHover.miniCart.mi",function(){i||(e.miniCartEntry.find(".loading").show().siblings().hide(),e.removing=!1,e.getData())})}var e;Xiaomi.prototype.loadMiniCart=function(){return e=e||new t(this)},t.prototype.updateCartNum=function(){this.cartNum=Xiaomi.utils.cookie("xm_user_"+this.context.globalConfig.appLocal.name+"_num"),this.cartNum&&parseInt(this.cartNum)>0?($("#J_miniCartNum").text(this.cartNum),$("#J_miniCartIcon").attr("class","iconfont-cartfull-24")):($("#J_miniCartNum").text(0),$("#J_miniCartIcon").attr("class","iconfont-cartempty-24"))},t.prototype.removeGoods=function(t){var e=this;$.ajax({type:"POST",url:("https"==e.context.globalConfig.protocol?e.context.globalConfig.httpsOrderSite:e.context.globalConfig.orderSite)+"/cart/delete/"+t,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(t){e.removing=!0,e.getData()}})},t.prototype.getData=function(){var t=this;$.ajax({type:"GET",url:("https"==t.context.globalConfig.protocol?t.context.globalConfig.httpsOrderSite:t.context.globalConfig.orderSite)+"/cart/miniNew",dataType:"jsonp",jsonp:"jsonpcallback",cache:!1,success:function(e){t.formatData(e),t.updateCartNum(),t.miniCartEntry.trigger("contentChanged.mi")}})},t.prototype.formatData=function(t){var e=this;if(e.miniCartEntry.find(".loading").hide(),0==t.errorno){if(!(t.totalItem>0))return e.miniCartEntry.find(".filled-cart").hide().siblings(".empty-cart").show(),!1;e.removing||e.miniCartEntry.find(".empty-cart").hide().siblings(".filled-cart").show();for(var i=0;i<t.items.length;i+=1){var n=t.items[i];n.showType=Xiaomi.CONST.ShowType[n.show_type],"undefined"==typeof n.showType&&(n.showType="")}for(var i=0;i<t.items.length;i++)t.items[i].salePrice=Xiaomi.formatNum(t.items[i].salePrice,GLOBAL_CONFIG.appLocal.name);var o=e.itemListTemplate(t.items);e.removing?e.removingItem(o,function(){e.updateCartSummary(t)}):(e.updateCartSummary(t),$("#J_miniCartItemList").html(o))}},t.prototype.updateCartSummary=function(t){var e="item";t.total>1&&(e="items"),$("#J_miniCartItemCount").text(t.total+" "+e),$("#J_miniCartSumPrice").text(Xiaomi.formatNum(t.totalPrice,GLOBAL_CONFIG.appLocal.name))},t.prototype.removingItem=function(t,e){for(var i=$("#J_miniCartItemList").html().match(/data\-gid=\"[^\"]+\"/g),n=t.match(/data\-gid=\"([^\"]+)\"/g),o=0;o<i.length;o++){for(var a=0;a<n.length&&i[o]!=n[a];a++);a==n.length&&$("#J_miniCartItemList li:eq("+o+")").animate({height:0,opacity:0},"fast",function(){$(this).remove(),e()})}}}(),function(){function t(t){this.context=t}function e(t,e){this.context=e,this.config={sku:null,callback:null,sourceVal:"bigtap"},this.inTheQueue=!1,$.extend(this.config,t),this.startQueue(),this.getDmSys();var i=this;$("#xmDmReload").on("click",function(){i.startQueue(),i.getDmSys()})}var i;Xiaomi.prototype.cart=function(){return i=i||new t(this)},t.prototype.cartAdd=function(t,e,i){var n=this;$.ajax({url:t,dataType:"jsonp",jsonp:"jsonpcallback",success:function(t){if(i&&i(t),t&&0===t.code){var o="xm_user_"+n.context.globalConfig.appLocal.name+"_num",a=Xiaomi.utils.cookie(o);n.context.localCookie(o,Number(a)+1),e&&e(t)}else alert(t.message)}})},t.prototype.addGood=function(t,i,n){t=parseInt(t),this.context.globalConfig.damiaoGoodsId=$.map(this.context.globalConfig.damiaoGoodsId,function(t,e){return parseInt(t)}),-1!=$.inArray(t,this.context.globalConfig.damiaoGoodsId)?Xiaomi.utils.cookie("serviceToken")?new e({sku:t,callback:i},this.context):Xiaomi.utils.cookie("userId")?this.context.proxyIframe(function(){new e({sku:t,callback:i},this.context)},this):window.location.href=this.context.globalConfig.orderSite+"/site/login":n?this.cartAdd(this.context.globalConfig.orderSite+"/cart/add/"+t,i,n):this.cartAdd(this.context.globalConfig.orderSite+"/cart/add/"+t,i)},t.prototype.removeGood=function(t,e){var i=this;$.ajax({type:"POST",url:i.context.globalConfig.orderSite+"/cart/delete/"+t,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(t){t&&1===t.deleteBatch?e&&e(t):alert(t.msg)}})},e.prototype.getDmSys=function(){var t=this,e=this.context.globalConfig.damiaoSite+"hdget/"+this.context.globalConfig.appLocal.name+"?source="+this.config.sourceVal+"&product="+this.config.sku+"&addcart=1&m=1&_="+(new Date).getTime();$.ajax({url:e,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdcontrol",timeout:3e4,error:function(){return t.inTheQueue?(t.stopQueue(),void $("#xmDmError").modal({show:!0,backdrop:"static"})):!1},success:function(e){var n,o=e.status,a=o[t.config.sku].hdurl,r=o[t.config.sku].hdstart===!1&&o[t.config.sku].hdstop===!0?!0:!1,s=e.d22a51?1e3*e.d22a51:5e3;return t.inTheQueue?r===!0?(t.stopQueue(),alert("We are sorry to tell you this item is sold out."),window.location.reload(),!1):(t.getDmTimer&&clearTimeout(t.getDmTimer),void(a?(n=t.context.globalConfig.orderSite+"/cart/add/"+t.config.sku+"?source="+t.config.sourceVal+"&token="+a,i.cartAdd(n,t.config.callback,$.proxy(t.stopQueue,t))):(t.inTheQueue||t.startQueue(),t.getDmTimer=setTimeout(function(){t.getDmSys()},s)))):!1}})},e.prototype.startQueue=function(){var t=this;$("#xmDmError").modal("hide"),$("#xmDmQueue").modal({show:!0,backdrop:"static"}),t.queueAnimate(),t.inTheQueue=!0,$("#xmDmQueue").on("hidden.bs.modal",function(){t.stopQueue()})},e.prototype.stopQueue=function(){$("#xmDmQueue").modal("hide"),this.inTheQueue=!1,this.getDmTimer&&clearTimeout(this.getDmTimer),this.queueAnimateTimer&&clearInterval(this.queueAnimateTimer)},e.prototype.queueAnimate=function(){var t=0,e=200,i=function(){t-=90,-900>=t&&(t=0),$("#mituWalking").css({backgroundPosition:t+"px 0"})};this.queueAnimateTimer=setInterval(i,e)}}(),Xiaomi.userCountry={speed:500,currentCountry:"",constructCountrySelect:function(){var t=this,e="",i=Xiaomi.utils.cookie("xm_viewer_locale"),n="";if($(".main-category").each(function(){"STORE"===$(this).find("a").text().trim().toUpperCase()&&(n=$(this))}),$.each(GLOBAL_CONFIG.globalLocales,function(n,o){i===n?(e+='<li class="region-entry global-entry"><a href="javascript:void(0);" class="active"  data-fullname="'+o+'" data-country="'+n+'">'+o+'<i class="iconfont">&#xe932;</i></a></li>',$("#J_selectRegin").text(o).attr("data-region",n),$(".order-entry").show(),$("#J_miniCartEntry").show()):(e+='<li class="region-entry global-entry"><a href="javascript:void(0);" data-country="'+n+'" data-fullname="'+o+'">'+o+"</a></li>",t.currentCountry=i)}),i){var o=!1;$.each(GLOBAL_CONFIG.globalLocales,function(t,e){i===t&&(o=!0)}),o?e+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International">International</a></li>':(e+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International" class="active">International<i class="iconfont">&#xe932;</i></a></li>',$(".order-entry").hide(),$("#J_miniCartEntry").hide(),n&&n.hide(),$("#J_selectRegin").text("International").attr("data-region","en"))}else i="en",e+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International" class="active">International<i class="iconfont">&#xe932;</i></a></li>',$(".order-entry").hide(),$("#J_miniCartEntry").hide(),n&&n.hide(),$("#J_selectRegin").text("International").attr("data-region","en");""!==t.currentCountry&&null!==t.currentCountry?$.each(GLOBAL_CONFIG.globalLocalsUrl,function(t,i){e+='<li class="region-entry"><a href="'+i+'">'+t+"</a></li>"}):($.each(GLOBAL_CONFIG.separateSites,function(o,a){i===o?(e+='<li class="region-entry"><a href="'+a.link+'">'+a.title+'<i class="iconfont">&#xe932;</i></a></li>',$("#J_selectRegin").text(a.title).attr("data-region",o),$(".order-entry").show(),$("#J_miniCartEntry").show(),n&&n.show()):(e+='<li class="region-entry global-entry"><a href="'+a.link+'" data-country="'+o+'" data-fullname="'+a.title+'">'+a.title+"</a></li>",t.currentCountry=i,n&&n.hide())}),e+='<li class="region-entry global-entry"><a href="http://www.mi.com/mena/" data-country="mena" data-fullname="Mena">Mena</a></li>'),$(".J_regionList ul").html(e),$(".J_regionList").on("click","a",function(){var e=$(this);if(e.closest("li").hasClass("J_international")?($(".order-entry").hide(),$("#J_miniCartEntry").hide()):($(".order-entry").show(),$("#J_miniCartEntry").show()),e.closest("li").hasClass("global-entry")){$(".J_regionList").find("a").each(function(){var t=($(this).data("country"),$(this).data("fullname"));$(this).removeClass("active").html(t)});var i=$(this).attr("data-country")?$(this).attr("data-country"):"en";$("#J_selectRegin").text($(this).text()).attr("data-region",i),$(this).addClass("active").append('<i class="iconfont">&#xe932;</i>'),e.closest("li").hasClass("J_international")?(Xiaomi.utils.cookie("xm_viewer_locale",null,{path:"/"+GLOBAL_CONFIG.appLocal.name,expires:3650}),n&&n.hide()):(Xiaomi.utils.cookie("xm_viewer_locale",null,{domain:".mi.com",path:"/",expires:3650}),setTimeout(function(){t.currentCountry=e.data("country"),Xiaomi.utils.cookie("xm_viewer_locale",t.currentCountry,{path:"/"+GLOBAL_CONFIG.appLocal.name,expires:3650})},300),n&&n.show())}})},init:function(){this.constructCountrySelect()}};var utils={UTC_MAP:{"in":5.5,id:7,sg:8,my:8,ph:8,tw:8,hk:8},getUTCDate:function(t,e){var i=t,n=this.UTC_MAP[e||xiaomi.globalConfig.appLocal.name]||0,o=new Date(i),a=o.getTimezoneOffset(),r=60*(a+60*n)*1e3,s=i+r;return new Date(s)},getUTCTime:function(t,e){var i=new Date(t),n=this.UTC_MAP[e||xiaomi.globalConfig.appLocal.name]||0,o=i.getTimezoneOffset(),a=60*(o+60*n)*1e3,r=i.getTime()-a;return r},checkEmail:function(t){var e;return e=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,e.test(t)?!0:!1},checkMobile:function(t,e){var i;switch(e=e||xiaomi.globalConfig.appLocal.name){case"in":i=/^\d{10}$/;break;default:i=/^\d{8,12}$/}return i.test(t)?!0:!1},formatPrice:function(t,e){!e&&(e=",");var i=t.toString().split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,e),i.join(".")}};$.extend(Xiaomi.utils,utils),$(function(){$(".J_foldingEntry").each(function(){var t,e=$(this),i=e.children("a"),n=i.next(),o=200,a=!1;i.mouseover(function(){a||(e.trigger("mouseHover.mi"),e.addClass("hover"),n.animate({height:n.children().outerHeight()},"fast"),a=!0)}),e.hover(function(){t&&clearTimeout(t)},function(){t=setTimeout(function(){n.removeClass("auto-height").animate({height:0},"fast"),e.removeClass("hover"),a=!1,t=null},o)}),e.bind("contentChanged.foldingEntry.mi",function(){a&&n.stop().animate({height:n.children().outerHeight()},"fast",function(){n.addClass("auto-height")})})}),function(){var t=$("#J_curtain"),e=-1,i=!1;$("#J_shopCategories").on("mouseenter",".main-category a",function(){if(i)return!1;var n=$(this).parents(".main-category"),o=n.parent().index();if(n.next().length>0){if(o!=e){$("#J_shopCategories").find("dl").eq(e).children(".products-exhibit").hide();var a=n.next().find(".product-image img");$.each(a,function(t,e){!$(e).attr("src")&&$(e).attr("src",$(e).attr("data-src"))}),e=o,n.next().show()}t.addClass("unfolding")}else t.removeClass("unfolding"),$("#J_shopCategories").find("dl").eq(e).children(".products-exhibit").hide(),e=-1}),$("#J_shopCategories").on("mouseleave",function(){return i?!1:(t.removeClass("unfolding"),void(t.hasClass("index")&&($("#J_shopCategories").find("dl").eq(e).children(".products-exhibit").hide(),e=-1)))}),$("#J_searchHandler").on("click",function(){return i?(i=!1,t.removeClass("search-unfolding"),$(".site-search-backdrop").remove(),$(this).children().addClass("iconfont-search-24").removeClass("iconfont-search-close-24"),$("#J_siteSearch").hide(),$("#J_siteSearchQuickLinks").removeClass("show")):(i=!0,t.addClass("search-unfolding"),$("#J_shopCategories").find("dl").eq(e).children(".products-exhibit").hide(),$("body").append('<div class="site-search-backdrop"></div>'),$(this).children().removeClass("iconfont-search-24").addClass("iconfont-search-close-24"),$("#J_siteSearch").show(),$("#J_siteSearchInput").focus(),$("#J_siteSearchQuickLinks").addClass("show")),!1}),$("body").on("click.foldingSearch.mi",function(t){i&&"J_curtain"!=t.target.id&&($(t.target).parents("#J_curtain").length>0&&0==$(t.target).parent(".main-category").length||($("#J_searchHandler").trigger("click"),$(t.target).trigger("mouseenter")))}),$("#J_siteSearchInput").on("keydup paste input",function(){var t=$.trim($(this).val());$("#J_siteSearchSubmit").prop("disabled",""==t)}),$("#J_siteSearchForm").on("submit",function(){var t=$.trim($("#J_siteSearchInput").val());return""!==t&&(t=t.replace(/[\-_'=+|\\\/]/g," "),window.location.href=GLOBAL_CONFIG.orderSite+"/search_"+encodeURIComponent(t)),!1})}(),function(){function t(){n.animate({height:r},"fast"),o.addClass("active"),i=!0}function e(){n.animate({height:0},"fast",function(){o.removeClass("active")}),i=!1}var i=!1,n=$("#J_sitesList"),o=$("#J_siteSwitchHandle"),a=$("#J_siteSwitch"),r=n.children().outerHeight();n.css("width",n.children().outerWidth()),a.css("width",n.children().outerWidth()),$("#J_siteSwitchHandle").on("click",function(){return i?e():t(),!1}),$("body").on("click.foldingSiteSwitch.mi",function(t){0==$(t.target).parents(".site-switch").length&&i&&e()})}(),$("#J_emailSubscribe").on("submit",function(){var t=$(this);return Xiaomi.utils.checkEmail(t.find('[name="email"]').val())?($.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize(),dataType:"jsonp",jsonp:"jsonpcallback",success:function(e){e&&0==e.errno&&t.find(".sub-prompt").children().hide().filter(".success").show()},error:function(){}}),!1):(t.find(".sub-prompt").children().hide().filter(".invalid").show(),!1)})}),Xiaomi.CONST={ShowType:{buy:"",bargain:"[Sale]",gift:"[Gift]",seckill:"[Flash Deal]",special:"[Special]",ernie:"[Shake]",presales:"[Pre-sale]",fcode:"[F-code]"}};